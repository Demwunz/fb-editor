<h1 class="govuk-heading-xl"><%= t('publish.heading') %></h1>
<p id="publish-intro">
  You are publishing the version from <span class="date version">
  <%= l(service.created_at.to_time.in_time_zone('London'), format: :date) %></span>
  <span class="time version">
  <%= l(service.created_at.to_time.in_time_zone('London'), format: :time) %></span>.
</p>

<dl id="publish-environments">
  <dt class="environment govuk-heading-l"><%= t('publish.test.heading') %></dt>
  <dd>
    <p class="description"><%= t('publish.test.description') %></p>

    <% if @published_dev %>
      <p><%= PublishServicePresenter.hostname_for(deployment_environment: 'dev', view: self) %></p>
    <% end %>

    <% if @publish_page_presenter_dev.no_service_output? %>
      <%= render 'service_output_warning', environment: t('publish.environment.test') %>
    <% end %>

    <%= render 'submission_warning', submission_presenter: @publish_page_presenter_dev.submission_warnings %>

    <%= render 'autocomplete_warning', environment: t('publish.environment.test'), text: 'publish.warning.autocomplete_items' %>

    <button class="govuk-button fb-govuk-button"
        data-module="govuk-button"
        type="button"
        data-fb-action="publish"
        hidden >
        <%= t('actions.publish_to_test') %>
    </button>

    <%= form_for(@publish_page_presenter_dev.publish_creation,
        url: publish_index_path(service.service_id),
        html: { id: 'publish-form-dev', class: 'publish-form', data: { first_publish: false } }) do |f| %>
      <%= render 'form', f: f, deployment_environment: 'dev' %>
      <div class="govuk-button-group govuk-!-margin-bottom-0">
        <button class="govuk-button fb-govuk-button" type="submit">
          <%= t('actions.publish_to_test') %>
        </button>

        <button class="govuk-button govuk-button--secondary" data-module="govuk-button" type="button">
          <%= t('actions.cancel') %>
        </button>
      </div>
    <% end %>
  </dd>

  <dt class="environment govuk-heading-l"><%= t('publish.live.heading') %></dt>
  <dd>
    <p class="description"><%= t('publish.live.description') %></p>

    <% if @published_production %>
      <p><%= PublishServicePresenter.hostname_for(deployment_environment: 'production', view: self) %></p>
    <% end %>

    <% if @publish_page_presenter_production.no_service_output? %>
      <%= render 'service_output_warning', environment: t('publish.environment.live') %>
    <% end %>

    <%= render 'submission_warning', submission_presenter: @publish_page_presenter_production.submission_warnings %>

    <%= render 'autocomplete_warning', environment: t('publish.environment.live'), text: 'publish.error.autocomplete_items' %>

    <button class="govuk-button fb-govuk-button"
            data-module="govuk-button"
            type="button"
            aria-disabled="<%= @autocomplete_warning.messages.blank? ? 'false' : 'true' %>"
            data-fb-action="publish"
            hidden >
            <%= t('actions.publish_to_live') %>
    </button>

    <%= form_for(@publish_page_presenter_production.publish_creation,
        url: publish_index_path(service.service_id),
        html: { id: 'publish-form-live', class: 'publish-form', data: { first_publish: false } }) do |f| %>
      <%= render 'form', f: f, deployment_environment: 'production' %>
      <div class="govuk-button-group govuk-!-margin-bottom-0" <%= @autocomplete_warning.messages.blank? ? '' : 'disabled="disabled"' %>>
        <button class="govuk-button fb-govuk-button" type="submit">
          <%= t('actions.publish_to_live') %>
        </button>
        <button class="govuk-button govuk-button--secondary" data-module="govuk-button" type="button">
          <%= t('actions.cancel') %>
        </button>
      </div>
    <% end %>
  </dd>
</dl>
