<%= conditional.fields_for :expressions do |expression| %>
  <div class="condition govuk-form-group" data-controller="conditional" data-conditional-error-class="error">
    <div class="question">
      <%= expression.label :component, (expression.options[:child_index] == 0 ? t('branches.expression.if') : t('branches.expression.and')), { class: "govuk-label" } %>
      <%= expression.select :component,
        @conditional_content.previous_questions,
        { include_blank: t('branches.select_question') },
        { class: 'govuk-select',
          data: {
            action: 'change->conditional#getExpression',
            'conditional-target': 'question',
            'conditional-url-param': api_service_conditional_content_expressions_path(service.service_id, '--componentId--', conditional.options[:child_index], expression.options[:child_index]),
          },
        }
      %> 
      <p class="error-message" data-conditional-target="errorMessage" hidden><%= t('activemodel.errors.messages.unsupported') %></p> 
    </div>
    
    <div class="conditional_<% conditional.options[:child_index] %>_expressions">
      <%= render partial: 'expression_answers',
                locals: {
                  f: default_form_builder.new(:expression, expression.object, self, {}),
                  expression: expression.object,
                  conditional_index: conditional.options[:child_index],
                  expression_index: expression.options[:child_index]
                }
              %>
    </div>

    <%= link_to 'Add condition', '#', data: { turbo: true, turbo_method: :get, turbo_stream: '' } %>

  </div>

  <% end %>
